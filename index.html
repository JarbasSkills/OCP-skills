<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarbas OCP Skills</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Custom CSS styles */
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
        }
    
        .card {
            margin-bottom: 20px;
            border: none;
            transition: all 0.3s;
            position: relative;
        }
    
        .card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    
        .card-img-top {
            max-width: 100%;
            height: auto;
            max-height: 150px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            margin: auto;
            z-index: 2;
        }
    
        #skills-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            grid-gap: 20px;
        }
    
        .card-body {
            text-align: center;
            position: relative;
            z-index: 1;
            padding-bottom: 180px;
        }
    
        .preview {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            height: auto;
            background-color: rgba(255, 255, 255, 0.9);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
    
        .card:hover .preview {
            opacity: 1;
            pointer-events: auto;
        }
    
        .preview-content {
            padding: 20px;
        }
    
        .preview-content img {
            max-width: 100%;
            height: auto;
            max-height: 150px;
            margin-bottom: 10px;
        }
    
        .audio-qr-code-install-button {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s;
        }
    
        .audio-qr-code-install-button:hover {
            background-color: #0056b3;
        }
    
        .utterances {
            max-height: 100px;
            overflow-y: auto;
        }
    
        .slideshow {
            position: relative;
            max-height: calc(100% - 60px);
            overflow-y: auto;
        }
    
        .slideshow img {
            max-width: 100%;
            height: auto;
            width: auto\9;
            max-height: 150px;
            display: block;
            margin: 0 auto;
        }
    
    </style>

</head>
<body>
<div id="app" class="container">
    <!-- Introduction section -->
    <div id="intro" class="jumbotron">
        <h1 class="display-4">Welcome to Jarbas OCP Skills!</h1>
        <p class="lead">In this page you can find all my Media skills</p>
        <!-- Note about audio QR code installs -->
        <p>Note: Devices need to have the <a href="https://github.com/OpenVoiceOS/ovos-audio-transformer-plugin-ggwave">OVOS
            GGWave Plugin</a> installed and enabled for audio QR code installs to work. Skills will be installed directly from github</p>
        <hr class="my-4">
        <p>Below, you'll find a list of available skills:</p>
    </div>
    
    <!-- Skills container -->
    <div id="skills-container">
        <!-- Skill cards generated dynamically using Vue.js -->
        <div class="card" v-for="skill in skills" :key="skill.skill_id">
            <!-- Link to skill source code -->
            <a :href="skill.source" target="_blank" rel="noopener noreferrer">
                <!-- Skill icon -->
                <img :src="skill.icon" class="card-img-top" :alt="skill.name">
            </a>
            <!-- Skill information -->
            <div class="card-body" @mouseover="showPreview(skill)" @mouseleave="hidePreview(skill)">
                <h5 class="card-title">{{ skill.name }}</h5> <!-- Skill name -->
                <p class="card-text">{{ skill.description }}</p> <!-- Skill description -->
                <!-- Utterance examples -->
                <div class="utterances">
                    <p v-for="(example, index) in skill.examples" :key="index" v-if="index < 5">{{ example }}</p>
                </div>
                <!-- Preview section -->
                <div class="preview" v-if="skill.showPreview">
                    <!-- Picture slideshow -->
                    <div class="slideshow">
                        <img v-for="image in skill.images" :src="image" class="slide" :key="image" :alt="skill.name">
                    </div>
                </div>
                <!-- Audio QR Code Install button -->
                <button class="audio-qr-code-install-button" @click="transmitPackage(skill.source)">Audio QR Code Install</button>
            </div>
        </div>
    </div>

    <!-- Additional information section -->
    <div id="additional-info" class="mt-5">
        <!-- Information about JSON feed -->
        <p>A JSON feed is automatically published at <a
                href="https://jarbasskills.github.io/OCP-skills/skills.json">https://jarbasskills.github.io/OCP-skills/skills.json</a>
            to be consumed by 3rd party UIs or applications.</p>
    </div>

</div>

<!-- Vue.js library -->
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<!-- ggwave.js script -->
<script type="text/javascript" src="ggwave.js"></script>
<script type='text/javascript'>
    // Ensure variables are properly scoped
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    window.OfflineAudioContext = window.OfflineAudioContext || window.webkitOfflineAudioContext;

    var context = null;

    // the ggwave module instance
    var ggwave = null;
    var parameters = null;
    var instance = null;

    // instantiate the ggwave instance
    // ggwave_factory comes from the ggwave.js module
    ggwave_factory().then(function(obj) {
        ggwave = obj;
    });

    // Initialize audio context and ggwave
    function init() {
        if (!context) {
            context = new AudioContext({sampleRate: 48000});

            parameters = ggwave.getDefaultParameters();
            parameters.sampleRateInp = context.sampleRate;
            parameters.sampleRateOut = context.sampleRate;
            instance = ggwave.init(parameters);
        }
    }

    // Transmit data using ggwave
    function transmitPackage(packageName) {
        init();

        // Generate audio waveform with the package name
        var waveform = ggwave.encode(instance, "GHS:" + packageName, ggwave.ProtocolId.GGWAVE_PROTOCOL_AUDIBLE_FAST, 10);

        // Play audio
        var buf = convertTypedArray(waveform, Float32Array);
        var buffer = context.createBuffer(1, buf.length, context.sampleRate);
        buffer.getChannelData(0).set(buf);
        var source = context.createBufferSource();
        source.buffer = buffer;
        source.connect(context.destination);
        source.start(0);
    }

    // Helper function to convert typed arrays
    function convertTypedArray(src, type) {
        var buffer = new ArrayBuffer(src.byteLength);
        var baseView = new src.constructor(buffer).set(src);
        return new type(buffer);
    }

    // Vue.js initialization
    document.addEventListener('DOMContentLoaded', function() {
        new Vue({
            el: '#app',
            data: {
                skills: [] // Array to store fetched skills
            },
            mounted() {
                // Fetch skills when the component is mounted
                this.fetchSkills();
            },
            methods: {
                // Method to fetch skills data
                fetchSkills() {
                    // Fetch skills JSON data from the specified URL
                    fetch('https://jarbasskills.github.io/OCP-skills/skills.json')
                        .then(response => response.json()) // Parse response as JSON
                        .then(data => {
                            // Initialize showPreview property for each skill
                            data.items.forEach(skill => {
                                skill.showPreview = false;
                            });
                            // Assign fetched skills to the data array
                            this.skills = data.items;
                        })
                        .catch(error => console.error('Error fetching skills:', error)); // Handle fetch errors
                },
                // Show preview on mouseover
                showPreview(skill) {
                    skill.showPreview = true;
                },
                // Hide preview on mouse leave
                hidePreview(skill) {
                    skill.showPreview = false;
                }
            }
        });
    });
</script>
</body>
</html>
