<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OVOS Skills Hatchery</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Custom CSS styles */
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
        }

        .card {
            margin-bottom: 20px;
            border: none;
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .card-img-top {
            max-width: 100%;
            height: auto;
            max-height: 100px; /* Limit image height */
        }

        #skills-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Responsive grid layout */
            grid-gap: 20px; /* Spacing between cards */
        }

        .card-body {
            text-align: center;
        }

        .audio-qr-code-install-button {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .audio-qr-code-install-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
<div id="app" class="container">
    <!-- Introduction section -->
    <div id="intro" class="jumbotron">
        <h1 class="display-4">Welcome to the OVOS Hatchery!</h1>
        <p class="lead">Adopt a skill! These skills are untested and unmaintained, they might be functional but are in need of a maintainer!</p>
        <!-- Note about audio QR code installs -->
        <p>Note: Devices need to have the <a href="https://github.com/OpenVoiceOS/ovos-audio-transformer-plugin-ggwave">OVOS
            GGWave Plugin</a> installed and enabled for audio QR code installs to work. Skills will be installed directly from github</p>
        <hr class="my-4">
        <p>Below, you'll find a list of available skills:</p>
    </div>

    <!-- Skills container -->
    <div id="skills-container">
        <!-- Skill cards generated dynamically using Vue.js -->
        <div class="card" v-for="skill in skills" :key="skill.skill_id">
            <!-- Link to skill source code -->
            <a :href="skill.source" target="_blank" rel="noopener noreferrer">
                <!-- Skill icon -->
                <img :src="skill.icon" class="card-img-top" :alt="skill.name">
            </a>
            <!-- Skill information -->
            <div class="card-body">
                <h5 class="card-title">{{ skill.name }}</h5> <!-- Skill name -->
                <p class="card-text">{{ skill.description }}</p> <!-- Skill description -->
                <!-- Audio QR Code Install button -->
                <button class="audio-qr-code-install-button" @click="transmitPackage(skill.source)">Audio QR Code
                    Install
                </button>
            </div>
        </div>
    </div>

    <!-- Additional information section -->
    <div id="additional-info" class="mt-5">
        <!-- Information about JSON feed -->
        <p>A JSON feed is automatically published at <a
                href="https://ovoshatchery.github.io/OVOS-Hatchery-skills/skills.json">https://openvoiceos.github.io/OVOS-Hatchery-skills/skills.json</a>
            to be consumed by 3rd party UIs or applications.</p>
        <!-- Information about licensing requirements -->
        <p>Please note that all skills hosted on this store must be licensed under an OSI-approved open-source license,
            or released into the public domain, except by special permission from the OVOS dev team.</p>
    </div>

</div>

<!-- Vue.js library -->
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<!-- ggwave.js script -->
<script type="text/javascript" src="ggwave.js"></script>
<script type='text/javascript'>
    // Ensure variables are properly scoped
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    window.OfflineAudioContext = window.OfflineAudioContext || window.webkitOfflineAudioContext;

    var context = null;

    // the ggwave module instance
    var ggwave = null;
    var parameters = null;
    var instance = null;

    // instantiate the ggwave instance
    // ggwave_factory comes from the ggwave.js module
    ggwave_factory().then(function(obj) {
        ggwave = obj;
    });

    // Initialize audio context and ggwave
    function init() {
        if (!context) {
            context = new AudioContext({sampleRate: 48000});

            parameters = ggwave.getDefaultParameters();
            parameters.sampleRateInp = context.sampleRate;
            parameters.sampleRateOut = context.sampleRate;
            instance = ggwave.init(parameters);
        }
    }

    // Transmit data using ggwave
    function transmitPackage(packageName) {
        init();

        // Generate audio waveform with the package name
        var waveform = ggwave.encode(instance, "GHS:" + packageName, ggwave.ProtocolId.GGWAVE_PROTOCOL_AUDIBLE_FAST, 10);

        // Play audio
        var buf = convertTypedArray(waveform, Float32Array);
        var buffer = context.createBuffer(1, buf.length, context.sampleRate);
        buffer.getChannelData(0).set(buf);
        var source = context.createBufferSource();
        source.buffer = buffer;
        source.connect(context.destination);
        source.start(0);
    }

    // Helper function to convert typed arrays
    function convertTypedArray(src, type) {
        var buffer = new ArrayBuffer(src.byteLength);
        var baseView = new src.constructor(buffer).set(src);
        return new type(buffer);
    }

    // Vue.js initialization
    document.addEventListener('DOMContentLoaded', function() {
        new Vue({
            el: '#app',
            data: {
                skills: [] // Array to store fetched skills
            },
            mounted() {
                // Fetch skills when the component is mounted
                this.fetchSkills();
            },
            methods: {
                // Method to fetch skills data
                fetchSkills() {
                    // Fetch skills JSON data from the specified URL
                    fetch('https://ovoshatchery.github.io/OVOS-Hatchery-skills/skills.json')
                        .then(response => response.json()) // Parse response as JSON
                        .then(data => {
                            // Assign fetched skills to the data array
                            this.skills = data.items;
                        })
                        .catch(error => console.error('Error fetching skills:', error)); // Handle fetch errors
                }
            }
        });
    });
</script>
</body>
</html>
